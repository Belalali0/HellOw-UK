<!DOCTYPE html>
<html lang="en" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HellOw UK</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+Arabic:wght@400;700&family=Poppins:wght@900&display=swap');
        :root { --bg-main: #f8fafc; --bg-card: #ffffff; --text-main: #1e293b; --border: #e2e8f0; --accent: #ffd700; }
        .dark { --bg-main: #0f172a; --bg-card: #1e293b; --text-main: #f1f5f9; --border: #334155; --accent: #ffd700; }
        body { font-family: 'Noto Sans Arabic', 'Poppins', sans-serif; background-color: var(--bg-main); color: var(--text-main); transition: 0.3s; margin: 0; overflow-x: hidden; }
        .mobile-shell { max-width: 480px; margin: 0 auto; min-height: 100vh; background: var(--bg-card); position: relative; box-shadow: 0 0 20px rgba(0,0,0,0.1); }
        .nav-bottom { position: fixed; bottom: 0; max-width: 480px; width: 100%; background: var(--bg-card); border-top: 1px solid var(--border); display: flex; justify-content: space-around; padding: 12px 0; z-index: 100; }
        .page { display: none; padding: 20px; animation: fadeIn 0.3s; }
        .active-page { display: block; }
        .active-nav { color: var(--accent) !important; }
        .input-field { width: 100%; padding: 12px; background: var(--bg-main); border: 1px solid var(--border); border-radius: 12px; outline: none; color: inherit; margin-bottom: 10px; }
        .custom-alert { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 1000; background: var(--bg-card); padding: 20px; border-radius: 20px; border: 2px solid #ff5555; width: 85%; max-width: 320px; text-align: center; box-shadow: 0 10px 40px rgba(0,0,0,0.3); }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body class="light">

<div id="msgModal" class="hidden fixed inset-0 bg-black/70 z-[1000] flex items-center justify-center p-4">
    <div class="custom-alert">
        <i id="msgIcon" class="fas fa-exclamation-circle text-4xl mb-3 text-red-500"></i>
        <p id="msgText" class="font-bold text-sm leading-relaxed mb-5"></p>
        <button onclick="closeMsg()" class="w-full bg-gray-800 text-white py-3 rounded-xl font-bold">OK</button>
    </div>
</div>

<div class="mobile-shell pb-24">
    <header class="sticky top-0 bg-[var(--bg-card)] border-b border-[var(--border)] p-4 flex justify-between items-center z-50">
        <div class="flex items-center gap-2 cursor-pointer" onclick="handleAdminTrigger()">
            <i class="fas fa-book-open text-2xl text-[var(--accent)]"></i>
            <div class="brand-text text-xl font-black italic">
                <span class="text-[#ff5555]">He</span><span class="text-slate-400">ll</span><span class="text-[#ffd700]">O</span><span class="text-slate-400">w</span> <span class="text-green-400">UK</span>
                <div id="lang-indicator" class="text-[9px] font-bold text-gray-400 uppercase tracking-[3px]">EN</div>
            </div>
        </div>
        <div class="flex items-center gap-4">
            <i id="header-heart" onclick="checkHeartStatus()" class="fas fa-heart-broken text-gray-400 text-xl cursor-pointer"></i>
            <i id="theme-icon" onclick="toggleTheme()" class="fas fa-moon text-xl cursor-pointer"></i>
            <select id="langSelect" onchange="changeLanguage(this.value)" class="bg-transparent font-bold text-xs outline-none">
                <option value="en">EN</option>
                <option value="ku">KU</option>
                <option value="ar">AR</option>
                <option value="fa">FA</option>
            </select>
        </div>
    </header>

    <div id="pages">
        <main id="home-page" class="page active-page"><div id="post-list" class="space-y-4"></div></main>
        <main id="info-page" class="page"><div id="info-list" class="space-y-4"></div></main>
        <main id="muslim-page" class="page"><div id="muslim-list" class="space-y-4"></div></main>
        <main id="org-page" class="page"><div id="org-list" class="space-y-4"></div></main>
        <main id="fav-page" class="page"><div id="fav-list" class="space-y-4"></div></main>
        
        <main id="account-page" class="page">
            <div id="auth-ui" class="space-y-4 text-center">
                <h2 class="text-xl font-bold lang-nav" data-key="acc">Account</h2>
                <input type="text" id="reg-user" placeholder="Username" class="input-field">
                <input type="email" id="reg-email" placeholder="Email" class="input-field">
                <input type="password" id="reg-pass" placeholder="Password" class="input-field">
                <div class="flex gap-2">
                    <button onclick="window.handleEmailAuth('login')" class="flex-1 bg-blue-600 text-white py-3 rounded-xl font-bold">Login</button>
                    <button onclick="window.handleEmailAuth('register')" class="flex-1 bg-gray-200 text-gray-700 py-3 rounded-xl font-bold">Register</button>
                </div>
            </div>
            <div id="user-profile" class="hidden text-center space-y-4 py-10">
                <i class="fas fa-user-circle text-7xl text-blue-500"></i>
                <p id="user-display-name" class="text-lg font-bold"></p>
                <p id="user-role-badge" class="text-xs font-black text-blue-500 uppercase"></p>
                <button onclick="window.signOutUser()" class="text-red-500 font-bold border-b border-red-500">Log Out</button>
            </div>
        </main>
    </div>

    <div id="adminModal" class="fixed inset-0 bg-black/80 hidden z-[500] p-4 flex items-center justify-center backdrop-blur-sm">
        <div class="bg-[var(--bg-card)] w-full max-w-sm rounded-3xl p-6 overflow-y-auto max-h-[90vh]">
            <div class="flex border-b mb-4 font-bold">
                <button onclick="switchTab('post')" id="tab-p-btn" class="flex-1 py-2 text-blue-600 border-b-2 border-blue-600">Post</button>
                <button onclick="switchTab('dash')" id="tab-d-btn" class="flex-1 py-2 opacity-40">Dashboard</button>
                <button onclick="closeAdmin()" class="px-2 text-red-500">X</button>
            </div>
            <div id="tab-post">
                <input type="text" id="p-title" placeholder="Title" class="input-field">
                <textarea id="p-text" placeholder="Content" class="input-field h-24"></textarea>
                <input type="text" id="p-media" placeholder="Image Link" class="input-field">
                <div class="flex gap-2 mb-4">
                    <select id="p-lang" class="flex-1 p-2 bg-[var(--bg-main)] rounded-lg"><option value="en">EN</option><option value="ku">KU</option><option value="ar">AR</option><option value="fa">FA</option></select>
                    <select id="p-cat" class="flex-1 p-2 bg-[var(--bg-main)] rounded-lg"><option value="home">News</option><option value="info">Info</option><option value="muslim">Muslim</option><option value="org">Org</option></select>
                </div>
                <button onclick="window.submitPost()" class="w-full bg-blue-600 text-white py-3 rounded-xl font-bold">Post Now</button>
            </div>
            <div id="tab-dash" class="hidden">
                <div class="grid grid-cols-2 gap-2 text-[10px] font-bold text-center mb-4">
                    <div class="bg-blue-100 dark:bg-blue-900/30 p-2 rounded-lg text-blue-600">Users: <span id="acc-count">0</span></div>
                    <div class="bg-green-100 dark:bg-green-900/30 p-2 rounded-lg text-green-600">Online: <span id="online-count">1</span></div>
                </div>
                <div id="owner-only-section" class="hidden">
                    <input type="text" oninput="window.searchUser(this.value)" placeholder="Search Email..." class="input-field text-sm">
                    <div id="user-list-admin" class="space-y-2 mt-2 max-h-48 overflow-y-auto"></div>
                </div>
            </div>
        </div>
    </div>

    <nav class="nav-bottom">
        <button onclick="showPage('home-page', this)" class="nav-item active-nav flex flex-col items-center">
            <i class="fas fa-home"></i><span class="text-[9px] mt-1 font-bold lang-nav" data-key="news">News</span>
        </button>
        <button onclick="showPage('info-page', this)" class="nav-item text-gray-400 flex flex-col items-center">
            <i class="fas fa-info-circle"></i><span class="text-[9px] mt-1 font-bold lang-nav" data-key="info">Info</span>
        </button>
        <button onclick="showPage('muslim-page', this)" class="nav-item text-gray-400 flex flex-col items-center">
            <i class="fas fa-mosque"></i><span class="text-[9px] mt-1 font-bold lang-nav" data-key="muslim">Muslim</span>
        </button>
        <button onclick="showPage('org-page', this)" class="nav-item text-gray-400 flex flex-col items-center">
            <i class="fas fa-hands-helping"></i><span class="text-[9px] mt-1 font-bold lang-nav" data-key="org">Org</span>
        </button>
        <button onclick="showPage('account-page', this)" class="nav-item text-gray-400 flex flex-col items-center">
            <i class="fas fa-user-circle"></i><span class="text-[9px] mt-1 font-bold lang-nav" data-key="acc">Account</span>
        </button>
    </nav>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
    import { getFirestore, collection, addDoc, onSnapshot, query, where, orderBy, doc, getDoc, setDoc, updateDoc } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";
    import { getAuth, onAuthStateChanged, createUserWithEmailAndPassword, signInWithEmailAndPassword, updateProfile, signOut } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";

    const firebaseConfig = {
        apiKey: "AIzaSyD-D5D-Frux74ptEWe62lge8AgKXwY6MJQ",
        authDomain: "hellowuk-72d77.firebaseapp.com",
        projectId: "hellowuk-72d77",
        storageBucket: "hellowuk-72d77.firebasestorage.app",
        messagingSenderId: "1029264488576",
        appId: "1:1029264488576:web:d83e815da5ee6831fd4e65"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);

    let currentLang = 'en';
    let currentUserData = null;

    const langData = {
        en: { news: "News", info: "Info", muslim: "Muslim", org: "Org", acc: "Account", error: "Invalid information provided!", heartBreak: "You broke my heart! To fix it, please create an account." },
        ku: { news: "هەواڵ", info: "زانیاری", muslim: "مسوڵمان", org: "ڕێکخراو", acc: "ئەکاونت", error: "زانیارییەکی هەڵەت داوە!", heartBreak: "تۆ دڵی منت شکاندووە! ئەگەر ئەتەوێ چاکی بکەیتەوە ئەکاونت دروست بکە." },
        ar: { news: "أخبار", info: "معلومات", muslim: "مسلم", org: "منظمات", acc: "حساب", error: "لقد قدمت معلومات خاطئة!", heartBreak: "لقد كسرت قلبي! لإصلاحه ، يرجى إنشاء حساب." },
        fa: { news: "اخبار", info: "اطلاعات", muslim: "مسلمان", org: "سازمان", acc: "حساب", error: "اطلاعات اشتباهی دادی!", heartBreak: "تو قلب من را شکستی! برای درست کردنش لطفا اکانت بساز." }
    };

    window.showAlert = (text, icon = "fa-exclamation-circle") => {
        document.getElementById('msgText').innerText = text;
        document.getElementById('msgIcon').className = `fas ${icon} text-4xl mb-3 text-red-500`;
        document.getElementById('msgModal').classList.remove('hidden');
    };

    window.closeMsg = () => document.getElementById('msgModal').classList.add('hidden');

    window.changeLanguage = (l) => {
        currentLang = l;
        document.documentElement.dir = l === 'en' ? 'ltr' : 'rtl';
        document.getElementById('lang-indicator').innerText = l.toUpperCase();
        document.querySelectorAll('.lang-nav').forEach(el => el.innerText = langData[l][el.dataset.key]);
        loadPosts();
    };

    window.checkHeartStatus = () => {
        if (!auth.currentUser) {
            showAlert(langData[currentLang].heartBreak, "fa-heart-broken");
        } else {
            showPage('fav-page', document.getElementById('header-heart'));
        }
    };

    onAuthStateChanged(auth, async (user) => {
        const heartIcon = document.getElementById('header-heart');
        if (user) {
            const userDoc = await getDoc(doc(db, "users", user.email));
            currentUserData = userDoc.data();
            document.getElementById('auth-ui').classList.add('hidden');
            document.getElementById('user-profile').classList.remove('hidden');
            document.getElementById('user-display-name').innerText = user.displayName || user.email;
            document.getElementById('user-role-badge').innerText = currentUserData?.role || 'user';
            heartIcon.classList.replace('fa-heart-broken', 'fa-heart');
            heartIcon.classList.replace('text-gray-400', 'text-red-500');
        } else {
            currentUserData = null;
            document.getElementById('auth-ui').classList.remove('hidden');
            document.getElementById('user-profile').classList.add('hidden');
            heartIcon.classList.replace('fa-heart', 'fa-heart-broken');
            heartIcon.classList.replace('text-red-500', 'text-gray-400');
        }
    });

    window.handleEmailAuth = async (type) => {
        const email = document.getElementById('reg-email').value;
        const pass = document.getElementById('reg-pass').value;
        const name = document.getElementById('reg-user').value;
        try {
            if (type === 'register') {
                const res = await createUserWithEmailAndPassword(auth, email, pass);
                await updateProfile(res.user, { displayName: name });
                await setDoc(doc(db, "users", email), { username: name, email: email, role: 'user' });
            } else {
                await signInWithEmailAndPassword(auth, email, pass);
            }
        } catch (e) { showAlert(langData[currentLang].error); }
    };

    window.signOutUser = () => signOut(auth);

    window.handleAdminTrigger = () => {
        if (currentUserData?.role === 'owner' || currentUserData?.role === 'admin') {
            document.getElementById('adminModal').classList.remove('hidden');
            if (currentUserData.role === 'owner') document.getElementById('owner-only-section').classList.remove('hidden');
        }
    };

    window.submitPost = async () => {
        try {
            await addDoc(collection(db, "posts"), {
                title: document.getElementById('p-title').value,
                text: document.getElementById('p-text').value,
                media: document.getElementById('p-media').value,
                lang: document.getElementById('p-lang').value,
                category: document.getElementById('p-cat').value,
                time: Date.now()
            });
            document.getElementById('adminModal').classList.add('hidden');
        } catch (e) { showAlert("Error publishing post"); }
    };

    function loadPosts() {
        const q = query(collection(db, "posts"), where("lang", "==", currentLang), orderBy("time", "desc"));
        onSnapshot(q, (snap) => {
            const containers = { home: 'post-list', info: 'info-list', muslim: 'muslim-list', org: 'org-list' };
            Object.values(containers).forEach(id => document.getElementById(id).innerHTML = "");
            snap.forEach(d => {
                const p = d.data();
                document.getElementById(containers[p.category]).innerHTML += `
                    <div class="bg-[var(--bg-card)] rounded-2xl border border-[var(--border)] p-4 shadow-sm mb-4">
                        ${p.media ? `<img src="${p.media}" class="w-full h-44 object-cover rounded-xl mb-3">` : ''}
                        <h3 class="font-bold text-md">${p.title}</h3>
                        <p class="text-xs opacity-70 mt-1">${p.text}</p>
                    </div>`;
            });
        });
    }

    onSnapshot(collection(db, "users"), (snap) => {
        document.getElementById('acc-count').innerText = snap.size;
        window.allUsers = [];
        snap.forEach(d => window.allUsers.push(d.data()));
        renderUserList(window.allUsers);
    });

    window.renderUserList = (users) => {
        const list = document.getElementById('user-list-admin');
        list.innerHTML = "";
        users.forEach(u => {
            list.innerHTML += `<div class="flex justify-between items-center bg-gray-50 dark:bg-gray-800 p-2 rounded-lg text-[10px] mb-1">
                <div><b>${u.username}</b><br>${u.email} <span class="text-blue-500 font-bold">[${u.role}]</span></div>
                ${currentUserData?.role === 'owner' ? `<div class="flex gap-1">
                    <button onclick="window.changeRole('${u.email}','admin')" class="bg-blue-600 text-white p-1 rounded">Admin</button>
                    <button onclick="window.changeRole('${u.email}','user')" class="bg-gray-400 text-white p-1 rounded">User</button>
                </div>` : ''}
            </div>`;
        });
    };

    window.changeRole = async (email, role) => {
        await updateDoc(doc(db, "users", email), { role });
    };

    window.searchUser = (val) => {
        const filtered = window.allUsers.filter(u => u.email.includes(val) || u.username.includes(val));
        renderUserList(filtered);
    };

    window.changeLanguage = (l) => {
    currentLang = l;
    // ئەم دێڕەی خوارەوە ڕێک وەک ئەمە لێ بکە بۆ ئەوەی هەمیشە بە ڕاست بمێنێتەوە
    document.documentElement.dir = 'rtl'; 
    
    document.getElementById('lang-indicator').innerText = l.toUpperCase();
    document.querySelectorAll('.lang-nav').forEach(el => el.innerText = langData[l][el.dataset.key]);
    loadPosts();
};

</script>

<script>
    function showPage(id, btn) {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active-page'));
        document.getElementById(id).classList.add('active-page');
        document.querySelectorAll('.nav-item').forEach(n => n.classList.replace('active-nav', 'text-gray-400'));
        if(btn && btn.classList.contains('nav-item')) btn.classList.replace('text-gray-400', 'active-nav');
    }
    function closeAdmin() { document.getElementById('adminModal').classList.add('hidden'); }
    function switchTab(t) {
        document.getElementById('tab-post').classList.toggle('hidden', t !== 'post');
        document.getElementById('tab-dash').classList.toggle('hidden', t !== 'dash');
        document.getElementById('tab-p-btn').className = t === 'post' ? "flex-1 py-2 text-blue-600 border-b-2 border-blue-600" : "flex-1 py-2 opacity-40";
        document.getElementById('tab-d-btn').className = t === 'dash' ? "flex-1 py-2 text-blue-600 border-b-2 border-blue-600" : "flex-1 py-2 opacity-40";
    }
    function toggleTheme() {
        document.body.classList.toggle('dark');
        document.getElementById('theme-icon').className = document.body.classList.contains('dark') ? "fas fa-sun text-yellow-300 text-xl cursor-pointer" : "fas fa-moon text-gray-900 text-xl cursor-pointer";
    }
</script>
</body>
</html>
